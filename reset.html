<!doctype html>
<html>
<head><meta charset="utf-8"><title>Resetar senha</title></head>
<body>
  <h2>Redefinir senha</h2>
  <form id="reset-form">
    <input type="password" id="new-pass" placeholder="Nova senha" required />
    <input type="password" id="confirm-pass" placeholder="Confirmar senha" required />
    <button type="submit">Redefinir</button>
  </form>
  <script>
    // ler token e email da URL
    const params = new URLSearchParams(location.search);
    const token = params.get("token");
    const email = params.get("email");
    document.getElementById('reset-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const newPassword = document.getElementById('new-pass').value.trim();
      const confirm = document.getElementById('confirm-pass').value.trim();
      if (!newPassword || newPassword.length < 6) return alert("Senha com mínimo 6 caracteres");
      if (newPassword !== confirm) return alert("As senhas não conferem");
      try {
        const res = await fetch("https://site-gamificadoback-cliente.onrender.com/auth/reset-password", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token, email, newPassword })
        });
        const data = await res.json();
        if (!res.ok) return alert(data.msg || "Erro");
        alert("Senha alterada com sucesso! Faça login.");
        window.location.href = "/login.html";
      } catch (err) { console.error(err); alert("Erro ao conectar ao servidor"); }
    });
  </script>
</body>
</html>
